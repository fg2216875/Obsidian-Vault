### 外部索引鍵特性:
#### **1. 確保資料完整性**

外鍵關聯性設定用來建立兩個資料表之間的關聯性，並確保資料的參照完整性（Referential Integrity）。
**範例：**  
	假設有兩個表：
    - **父表（Parent Table）**: `Customers` (客戶)
    - **子表（Child Table）**: `Orders` (訂單)
    
可以建立一個外鍵，讓 `Orders.CustomerID` 參考`Customers.CustomerID` 
這樣做會避免在 `Orders` 表中插入無效的 `CustomerID`。

#### **2. 限制資料的**插入與刪除**

您可以設定 ****插入** 或 **刪除行為** 的規則：
- **插入限制**：若子表的外鍵欄位值無法匹配父表的主鍵值，則**插入會失敗。
- **刪除限制**：
    - **Cascade**：當父表的記錄被刪除時，自動刪除子表中的相關記錄。
    - **Set Null**：當父表的記錄被刪除時，將子表的外鍵欄位設為 `NULL`。
    - **Set Default**：將子表的外鍵欄位設為預設值。
    - **No Action** 或 **Restrict**：禁止刪除父表中有關聯的記錄。

#### **3. 提升查詢效率**

當外鍵欄位與父表主鍵關聯時，SQL Server 可以更有效地執行查詢和連接操作，例如：
- **JOIN 操作的性能提升**。
- **啟用資料庫優化的執行計劃**。

#### **4. 減少潛在資料錯誤**

建立外鍵可減少不一致的資料，例如避免：
- 插入無效的外部鍵值。
- 刪除父表中的主鍵資料時，遺留孤立的子表記錄。


### 使用外鍵的問題:
#### 1.資料庫操作的效能影響

外鍵的存在會強制資料庫在執行插入、更新或刪除時，資料庫需要檢查它是否違反資料完整性，這可能會降低操作速度

#### 2.資料庫遷移

當需要從一個資料庫遷移到另一個資料庫時，外鍵可能會導致順序問題，因為需要確保先插入父表資料，然後再插入子表資料

**解決方法：**
- 在遷移時，先禁用外鍵，完成所有資料導入後再重新啟用。
- 使用腳本來確保插入順序正確。

觀察:
對於資料量大的資料庫，可能會選擇不建立外鍵(FK)，以避免影響效能

------
## 外鍵"強制使用外部索引鍵條件約束"

在 SSMS 的資料表設計介面中，可以為外鍵設定「強制使用外部索引鍵條件約束」：
1. **是（Enabled/Checked）**：外鍵條件約束會被強制執行，系統會檢查所有相關的資料完整性。
2. **否（Disabled/Unchecked）**：外鍵條件約束不會被強制執行，系統將跳過資料完整性的檢查。

1.建立強制外鍵
```sql
ALTER TABLE Orders
WITH CHECK ADD CONSTRAINT FK_Orders_Customers FOREIGN KEY (CustomerID)
REFERENCES Customers(CustomerID);
```

2.建立不強制外鍵
```sql
ALTER TABLE Orders
WITH NOCHECK ADD CONSTRAINT FK_Orders_Customers FOREIGN KEY (CustomerID)
REFERENCES Customers(CustomerID);
```

#### 如果設定"否"的話，那跟沒設定外鍵有甚麼差別呢?
- **不強制**：
    - 外鍵約束依然存在於資料庫中，只是不會執行資料完整性檢查。
    - 當需要時，可以啟用檢查（`CHECK CONSTRAINT`），以強制執行資料完整性。
    - 外鍵仍然可用於生成資料模型（如 ER 圖），讓工具知道資料表之間的關聯
- **沒設定外鍵**：
    - 完全沒有外鍵條件約束，無法追蹤關聯，也無法在未來快速啟用資料完整性。

| **功能/行為**     | **不強制外鍵** | **沒設定外鍵** |
| ------------- | --------- | --------- |
| **外部鍵結構存在**   | 是         | 否         |
| **資料完整性檢查**   | 無（可啟用）    | 無         |
| **操作性能**      | 與沒設定外鍵類似  | 最快        |
| **未來啟用的靈活性**  | 可以啟用檢查    | 必須重新建立外鍵  |
| **對第三方工具的影響** | 可見參照關係    | 無參照關係     |
