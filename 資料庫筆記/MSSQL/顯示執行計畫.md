### 建立索引
#### 索引 (index)
- 目的: SQL索引是資料庫的關鍵元素之一，主要目的為加速查詢速度
- 組成方式:索引通常包含一個或多個欄位，一張 table 有索引時，資料就會依照索引的鍵值排序及儲存，以便更迅速地檢索，索引通常使用 B-Tree 結構構建，若沒有索引的就是堆積(Heap)
- 類型:有兩種主要類型：叢集索引(clustered-index)和非叢集索引(non-clustered-index)
#### 叢集索引 (Clustered Index）
- 當資料表設定了「叢集索引」，那麼該資料表中的「實體資料列」的順序就會依據叢集索引鍵的值做排列。 所以任何一個資料表最多就只能有一個「叢集索引」。 
- 在 SQL Server ，Table的**主索引鍵**（PK）其屬性預設為「叢集索引」且是唯一的（Unique），若要將別的索引設定為叢集索引，則必須先取消主索鍵的叢集(Clustered)屬性。
![[Pasted image 20241126180235.png]]

#### 非叢集索引（NonClustered Index）
此類的索引單純存放著指標資料，而該指標所對應到的是 Clustered-Index 或是 Heaper 內實體資料所存放的位置。

---
### Scan (掃描) 
Scan 是指查詢執行時，系統會以整個資料表或整個索引的方式讀取資料，一筆筆去找出資料。

### Index Seek (搜尋) 
Seek 是指在一個使用 B-Tree 排序過的實體資料中尋找資料。 所以會使用 Seek 必定該資料建有**Index(索引)** 的情況下才有可能，

既使建了索引，資料庫也不見得會使用索引，得看查詢條件是否有正確使用索引，這與**查詢參數**有相當大的關連。
在查詢參數足夠**選擇性**（Selectivity）時，才會正確使用到索引。 選擇性是指合格資料列與總資料列的比率。 如果比率低，表示索引具有高度選擇性。
這項索引就可以排除大部分的資料列，並大幅減少結果集的大小。

---
### 資料表掃描（table scan）
這種搜尋方式，是當一個資料表沒有建立任何 Index 時所採取的資料搜尋方式，也就是實體資料以 Heap 架構存放時的處理方式

### 叢集索引掃描（clustered index scan）
當一個資料表雖有建立叢集索引，但是查詢的 WHERE 條件中卻沒有使用到實體資料排序， 這時的搜尋方式，就會掃過整個叢集索引，以找出符合的資料。

### 叢集索引搜尋（clustered index seek）
SQL Server 使用查詢參數中的第一個值，在**叢集索引**進行搜尋。 這種方式是最有效率的搜尋方式，資料完全利用叢集索引內所建立的實體資料排序。

假設`tbUser`資料表的索引為`UserID`
```sql
SELECT UserID FROM tbUser WHERE UserID=@UserID AND Password=@Password
SELECT UserID FROM tblUser WHERE UserID=@UserID
```
上述的指令都會採用**叢集索引搜尋**，雖然 Password 不是索引欄位，但是查詢條件中已包含了 UserID 這個索引欄位，所以整體會使用**叢集索引搜尋**。

```sql
SELECT UserID FROM tblUser WHERE Password=@Password
```
此指令採用**叢集索引掃描** ，只要沒有透過索引搜尋，當遇到資料量大的資料表時，效率就會降的非常快，因為它必須掃過所有的資料才能找到想要的資料。

### 索引掃描（index scan）
掃描整個**非叢集索引**。

參考:https://vito-note.blogspot.com/2013/05/blog-post_2862.html